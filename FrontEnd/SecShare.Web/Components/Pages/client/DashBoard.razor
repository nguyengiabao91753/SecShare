@page "/"


<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <div class="row file-header">
                        <button type="button" class="btn btn-lg btn-lg-square btn-primary m-2" data-toggle="modal" data-target="#uploadModal">
                            <i class="fa fa-plus"></i>
                        </button>

                        <!--Upload form-->
                        <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                <div class="modal-content">
                                    <!-- Header -->
                                    <div class="modal-header">
                                        <h5 class="modal-title">Tải lên tệp của bạn</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Đóng">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>

                                    <!-- Body -->
                                    <div class="modal-body text-center">
                                        <div class="p-5 border rounded bg-light">
                                            <i class="fa fa-cloud-upload-alt fa-4x text-primary mb-3"></i>
                                            <p class="lead">Kéo thả tệp vào đây hoặc nhấn nút bên dưới để chọn</p>

                                            <!-- Input file -->
                                            <input type="file" id="fileInput" hidden>
                                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click();">
                                                Duyệt qua
                                            </button>

                                            <!-- Preview file -->
                                            <div id="filePreview" class="mt-3 text-muted"></div>
                                        </div>
                                    </div>

                                    <!-- Footer -->
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                                        <button type="button" class="btn btn-success" onclick="uploadFile()">Tải lên</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--End upload form-->
                        <!--Js upload form-->
                        <script>
                            // Preview tên file sau khi chọn
                            document.getElementById("fileInput").addEventListener("change", function() {
                              let file = this.files[0];
                              if(file) {
                                document.getElementById("filePreview").textContent = "Đã chọn: " + file.name;
                              } else {
                                document.getElementById("filePreview").textContent = "";
                              }
                            });
                            // Upload (fake demo)
                            function uploadFile() {
                              let fileInput = document.getElementById("fileInput");
                              if(fileInput.files.length > 0) {
                                let file = fileInput.files[0];
                                alert("Đã tải lên: " + file.name);
                                $("#uploadModal").modal("hide");
                                fileInput.value = ""; // reset input
                                document.getElementById("filePreview").textContent = "";
                              } else {
                                alert("Vui lòng chọn một tệp trước!");
                              }
                            }
                        </script>
                        <!--End Js upload form-->
                        <h1 class="m-0">My files</h1>
                    </div>
                </div><!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item active">Home</li>
                    </ol>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->
    <!-- Main content -->
    <div class="container mt-4">
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-9">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="Search by name">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-control">
                        <option>Sort by</option>
                        <option>Name</option>
                        <option>Last Modified</option>
                        <option>Size</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- File Table -->
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Last Modified</th>
                    <th>Size</th>
                    <th style="width: 160px; text-align:right;">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ApacheJAMES.docx</td>
                    <td>12 minutes ago</td>
                    <td>272.0 KB</td>
                    <td class="action-cell">
                        <div class="d-flex justify-content-end">
                            <!-- Nhóm nút, mặc định ẩn -->
                            <div class="btn-group other-actions d-none">
                                <button class="btn btn-sm btn-light btn-preview" title="Preview">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-light" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>

                            <!-- Nút 3 chấm -->
                            <div class="btn-group">
                                <button class="btn btn-sm btn-light" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#">Details</a>
                                    <a class="dropdown-item" href="#">Share</a>
                                    <a class="dropdown-item" href="#">Rename</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-danger" href="#">Delete</a>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>LoremIpsum.doc</td>
                    <td>12 minutes ago</td>
                    <td>12.8 KB</td>
                    <td class="action-cell">
                        <div class="d-flex justify-content-end">
                            <div class="btn-group other-actions d-none">
                                <button class="btn btn-sm btn-light btn-preview" title="Preview">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-light" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>

                            <div class="btn-group">
                                <button class="btn btn-sm btn-light" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#">Detail</a>
                                    <a class="dropdown-item" href="#">Share</a>
                                    <a class="dropdown-item" href="#">Rename</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-danger" href="#">Delete</a>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Sidebar -->
        <div id="fileDetailSidebar" class="sidebar-detail">
            <div class="sidebar-header d-flex justify-content-between align-items-center p-3 border-bottom">
                <h5 class="mb-0">Chi tiết tập tin</h5>
                <button class="close" onclick="closeSidebar()">&times;</button>
            </div>

            <div class="sidebar-body p-3">
                <!-- Tabs -->
                <ul class="nav nav-tabs" id="sidebarTab" role="tablist">
                    <li class="nav-item col-md-4">
                        <a class="nav-link active" id="details-tab" data-toggle="tab" href="#details" role="tab">Details</a>
                    </li>
                    <li class="nav-item col-md-4">
                        <a class="nav-link" id="shares-tab" data-toggle="tab" href="#shares" role="tab">Shares</a>
                    </li>
                    <li class="nav-item col-md-4">
                        <a class="nav-link" id="activities-tab" data-toggle="tab" href="#activities" role="tab">Activities</a>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content mt-3">
                    <!-- Details -->
                    <div class="tab-pane fade show active" id="details" role="tabpanel">
                        <p><strong>Tên file:</strong> <span id="fileName"></span></p>
                        <p><strong>Kích thước:</strong> <span id="fileSize"></span></p>
                        <p><strong>Lần sửa đổi:</strong> <span id="fileModified"></span></p>
                    </div>

                    <!-- Shares -->
                    <div class="tab-pane fade" id="shares" role="tabpanel">
                        <input type="text" id="searchUser" class="form-control mb-3" placeholder="Search by name">
                        <ul class="list-group" id="userList">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-user-circle mr-2"></i> Peter Wilson
                                    <small class="text-muted d-block">Not downloaded</small>
                                </div>
                                <button class="btn btn-sm btn-outline-info btn-user-info" data-name="Peter Wilson" data-email="peter@example.com">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </li>
                        </ul>

                        <div class="input-group mt-3">
                            <input type="email" class="form-control" id="newEmail" placeholder="Enter email">
                            <div class="input-group-append">
                                <button class="btn btn-primary" id="btnShare">Share</button>
                            </div>
                        </div>
                    </div>

                    <!-- Activities -->
                    <div class="tab-pane fade" id="activities" role="tabpanel">
                        <p>Danh sách hoạt động gần đây sẽ hiển thị ở đây...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- JS -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
              const rows = document.querySelectorAll("table tbody tr");

              // Xử lý click vào row
              rows.forEach(row => {
                row.addEventListener("click", function () {
                  rows.forEach(r => {
                    r.classList.remove("table-active");
                    r.querySelector(".action-cell .other-actions").classList.add("d-none");
                  });

                  this.classList.add("table-active");
                  this.querySelector(".action-cell .other-actions").classList.remove("d-none");
                });
              });

              // Gắn sự kiện cho nút Preview
              document.querySelectorAll(".btn-preview").forEach(btn => {
                btn.addEventListener("click", function (e) {
                  e.stopPropagation(); // Không để row click trigger
                  let row = this.closest("tr");
                  let fileName = row.children[0].innerText;
                  let fileModified = row.children[1].innerText;
                  let fileSize = row.children[2].innerText;
                  openSidebar(fileName, fileSize, fileModified);
                });
              });

              // Tìm kiếm user
              document.getElementById("searchUser").addEventListener("keyup", function() {
                let filter = this.value.toLowerCase();
                let items = document.querySelectorAll("#userList li");
                items.forEach(item => {
                  let text = item.innerText.toLowerCase();
                  item.style.display = text.includes(filter) ? "" : "none";
                });
              });

              // Xem thông tin user
              document.addEventListener("click", function(e) {
                if(e.target.closest(".btn-user-info")) {
                  let btn = e.target.closest(".btn-user-info");
                  let name = btn.getAttribute("data-name");
                  let email = btn.getAttribute("data-email");
                  alert("Tên: " + name + "\nEmail: " + email);
                }
              });

              // Share email mới
              document.getElementById("btnShare").addEventListener("click", function() {
                let email = document.getElementById("newEmail").value;
                if(email) {
                  alert("Đã share với: " + email);
                  document.getElementById("newEmail").value = "";
                } else {
                  alert("Vui lòng nhập email!");
                }
              });
            });

            // Sidebar functions
            function openSidebar(fileName, fileSize, fileModified) {
              document.getElementById("fileName").textContent = fileName;
              document.getElementById("fileSize").textContent = fileSize;
              document.getElementById("fileModified").textContent = fileModified;
              document.getElementById("fileDetailSidebar").classList.add("show");
            }

            function closeSidebar() {
              document.getElementById("fileDetailSidebar").classList.remove("show");
            }
        </script>

    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        </ul>
    </nav>
</div>

@code {

}
